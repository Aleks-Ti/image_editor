# image_editor

Обработчик изображений с системой динамической подгрузки плагинов.

## Навигация

- [Инструкция к запуску](#запуск-и-подробности)
- [Обработчик изображения](#image-processor)
- [Плагины](#плагины)
- - [Зеркальный плагин](#mirror-plugin)
- - [Плагин размытия](#blur-plugin)

## Запуск и подробности

Для работы с [обработчиком изображения](#image-processor), в корне проекта есть файлы [blur_params.json](./blur_params.json) и [mirror_params.json](mirror_params.json), в них находятся данные для регулировки работы плагинов с изображением.

WARNING! Не рекомендуется для `blur_params.json` указывать большие числа, так как алгоритм наивный и может работать десятки минут или даже часы -_-

Прежде чем начать пользоваться программой, необходимо собрать плагины:

ссылки на команды:

- [сборка зеркального плагина](#mirror-plugin)
- [сборка плагина размытия](#blur-plugin)

После того как настройки были заданы, можно переходить к [командам запуска](./README.md#L28)

## image processor

Бинарное приложение, отвечающее за:

- загрузку изображения
- динамическую загрузку плагина
- передачу данных в плагин
- сохранение результата

Примеры комманд для запуска:

```bash
# запуск с mirror_plugin
cargo run -p image_processor --   input.png   output_mirror.png   mirror_plugin   mirror_params.json   --plugin-path target/debug
```

```bash
# запуск с blur_plugin
cargo run -p image_processor --   input.png   output_blur.png   blur_plugin   blur_params.json   --plugin-path target/debug
```

## Плагины

Плагины — динамические библиотеки (cdylib), которые:

- реализуют обработку изображения
- экспортируют C-совместимый ABI

Загружаются во время выполнения программы без перекомпиляции основного бинаря.

Как работает загрузка плагинов:

- Плагины компилируются в динамические библиотеки (.so, .dll, .dylib) с использованием C ABI.

Во время выполнения программы основной бинарь:

- Загружает библиотеку плагина с помощью системных механизмов ОС (dlopen / LoadLibrary).
- Получает указатель на экспортируемую функцию или таблицу функций через dlsym / GetProcAddress.
- Вызывает функции плагина через полученные указатели.
- Плагин загружается в адресное пространство текущего процесса.
- - Новый процесс не создаётся - код плагина выполняется в том же процессе, что и основное приложение.

### mirror plugin

```bash
# сборка плагина
cargo build -p mirror_plugin
```

### blur plugin

```bash
# сборка плагина
cargo build -p blur_plugin
```
